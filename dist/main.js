(()=>{var Z=e=>t=>{var n=e[t];if(n)return n();throw new Error("Module not found in bundle: "+t)};var B=(e,t)=>()=>(e&&(t=e(e=0)),t);async function Q(e,t,n){let r=await fetch(e,t),i=Number(r.headers.get("Content-Length")),s=r.headers.has("Content-Encoding")?Number(r.headers.get("X-Amz-Meta-Inflated-Content-Size")):null,o=i;(!Number.isInteger(i)||!Number.isFinite(i)||i<=0)&&(o=null);let a=s&&o?o/s:1,l=0;return new Response(new ReadableStream({async start(u){let c=r.body.getReader();for(;;){let{done:f,value:d}=await c.read();if(f){n(l*a,o,!0);break}l+=d.byteLength,n(l*a,o,!1),u.enqueue(d)}u.close()}}),{status:r.status,statusText:r.statusText,headers:r.headers})}function v(e,t){let n=new URL(e,location.href);n.search="";for(let[r,i]of Object.entries(t))r==="open"&&i.startsWith("/")&&(i=i.substr(1)),n.searchParams.set(r,i);return n.search=decodeURIComponent(n.search),n.toString()}function Y(e){let t=[];if(!FS.analyzePath(e).exists)return t;function n(r){for(let i of FS.readdir(r)){if(i==="."||i==="..")continue;let s=`${r}/${i}`,{mode:o,timestamp:a}=FS.lookupPath(s).node;FS.isFile(o)?t.push({path:s,timestamp:a}):FS.isDir(o)&&n(s)}}return n(e),t}function S(e,t,n){let r=document.createElement(e);return t&&(r.className=t),r.textContent=n,r}function L(e,t,n){let r=t||e,i=1,s=0;return n===void 0&&(r>1024**2?n="MB":r>1024?n="KB":n="B"),n==="B"?(i=1,s=0):n==="KB"?(i=1024,s=0):n==="MB"&&(i=1024**2,s=1),t===void 0?`${(e/i).toFixed(s)} ${n}`:`${(e/i).toFixed(s)}/${(t/i).toFixed(s)} ${n}`}var V,P=B(()=>{V=async e=>{let t=[];async function n(i){for await(let s of i.values())t.push(s),s.kind==="directory"&&await n(s)}await n(e);let r=new Map;r.set(".",e);for(let i of t){let s=(await e.resolve(i)).join("/");r.set(s,i)}return r}});var Le={};function be(e,t){return Object.assign(e,t)}var X,J=B(()=>{P();X={library:{}};be(X.library,{$FSFS__deps:["$FS","$MEMFS","$PATH"],$FSFS__postset:function(){return""},$FSFS:{DIR_MODE:16895,FILE_MODE:33279,mount:function(e){if(!e.opts.dirHandle)throw new Error("opts.dirHandle is required");return MEMFS.mount.apply(null,arguments)},syncfs:async(e,t,n)=>{try{let r=await FSFS.getLocalSet(e),i=await FSFS.getRemoteSet(e),s=t?i:r,o=t?r:i;await FSFS.reconcile(e,s,o),n(null)}catch(r){n(r)}},getLocalSet:e=>{var t=Object.create(null);function n(a){return a!=="."&&a!==".."}function r(a){return l=>PATH.join2(a,l)}for(var i=FS.readdir(e.mountpoint).filter(n).map(r(e.mountpoint));i.length;){var s=i.pop(),o=FS.stat(s);FS.isDir(o.mode)&&i.push.apply(i,FS.readdir(s).filter(n).map(r(s))),t[s]={timestamp:o.mtime,mode:o.mode}}return{type:"local",entries:t}},getRemoteSet:async e=>{let t=Object.create(null),n=await V(e.opts.dirHandle,!0);for(let[r,i]of n)r!=="."&&(t[PATH.join2(e.mountpoint,r)]={timestamp:i.kind==="file"?(await i.getFile()).lastModifiedDate:new Date,mode:i.kind==="file"?FSFS.FILE_MODE:FSFS.DIR_MODE});return{type:"remote",entries:t,handles:n}},loadLocalEntry:e=>{let n=FS.lookupPath(e).node,r=FS.stat(e);if(FS.isDir(r.mode))return{timestamp:r.mtime,mode:r.mode};if(FS.isFile(r.mode))return n.contents=MEMFS.getFileDataAsTypedArray(n),{timestamp:r.mtime,mode:r.mode,contents:n.contents};throw new Error("node type not supported")},storeLocalEntry:(e,t)=>{if(FS.isDir(t.mode))FS.mkdirTree(e,t.mode);else if(FS.isFile(t.mode))FS.writeFile(e,t.contents,{canOwn:!0});else throw new Error("node type not supported");FS.chmod(e,t.mode),FS.utime(e,t.timestamp,t.timestamp)},removeLocalEntry:e=>{var t=FS.stat(e);FS.isDir(t.mode)?FS.rmdir(e):FS.isFile(t.mode)&&FS.unlink(e)},loadRemoteEntry:async e=>{if(e.kind==="file"){let t=await e.getFile();return{contents:new Uint8Array(await t.arrayBuffer()),mode:FSFS.FILE_MODE,timestamp:t.lastModifiedDate}}else{if(e.kind==="directory")return{mode:FSFS.DIR_MODE,timestamp:new Date};throw new Error("unknown kind: "+e.kind)}},storeRemoteEntry:async(e,t,n)=>{let r=e.get(PATH.dirname(t)),i=FS.isFile(n.mode)?await r.getFileHandle(PATH.basename(t),{create:!0}):await r.getDirectoryHandle(PATH.basename(t),{create:!0});if(i.kind==="file"){let s=await i.createWritable();await s.write(n.contents),await s.close()}e.set(t,i)},removeRemoteEntry:async(e,t)=>{await e.get(PATH.dirname(t)).removeEntry(PATH.basename(t)),e.delete(t)},reconcile:async(e,t,n)=>{let r=0,i=[];Object.keys(t.entries).forEach(function(a){let l=t.entries[a],u=n.entries[a];(!u||FS.isFile(l.mode)&&l.timestamp.getTime()>u.timestamp.getTime())&&(i.push(a),r++)}),i.sort();let s=[];if(Object.keys(n.entries).forEach(function(a){t.entries[a]||(s.push(a),r++)}),s.sort().reverse(),!r)return;let o=t.type==="remote"?t.handles:n.handles;for(let a of i){let l=PATH.normalize(a.replace(e.mountpoint,"/")).substring(1);if(n.type==="local"){let u=o.get(l),c=await FSFS.loadRemoteEntry(u);FSFS.storeLocalEntry(a,c)}else{let u=FSFS.loadLocalEntry(a);await FSFS.storeRemoteEntry(o,l,u)}}for(let a of s)if(n.type==="local")FSFS.removeLocalEntry(a);else{let l=PATH.normalize(a.replace(e.mountpoint,"/")).substring(1);await FSFS.removeRemoteEntry(o,l)}}}});globalThis.FSFS=X.library.$FSFS;FS.filesystems.FSFS=FSFS});var R=(()=>{if(typeof self>"u")return!1;if("top"in self&&self!==top)try{top.window.document._=0}catch{return!1}return"showOpenFilePicker"in self})(),oe=R?Promise.resolve().then(function(){return ue}):Promise.resolve().then(function(){return he});async function j(...e){return(await oe).default(...e)}var se=R?Promise.resolve().then(function(){return fe}):Promise.resolve().then(function(){return we});async function N(...e){return(await se).default(...e)}var ae=R?Promise.resolve().then(function(){return pe}):Promise.resolve().then(function(){return ve});async function W(...e){return(await ae).default(...e)}var ce=async e=>{let t=await e.getFile();return t.handle=e,t},le=async(e=[{}])=>{Array.isArray(e)||(e=[e]);let t=[];e.forEach((i,s)=>{t[s]={description:i.description||"Files",accept:{}},i.mimeTypes?i.mimeTypes.map(o=>{t[s].accept[o]=i.extensions||[]}):t[s].accept["*/*"]=i.extensions||[]});let n=await window.showOpenFilePicker({id:e[0].id,startIn:e[0].startIn,types:t,multiple:e[0].multiple||!1,excludeAcceptAllOption:e[0].excludeAcceptAllOption||!1}),r=await Promise.all(n.map(ce));return e[0].multiple?r:r[0]},ue={__proto__:null,default:le};function F(e){function t(n){if(Object(n)!==n)return Promise.reject(new TypeError(n+" is not an object."));var r=n.done;return Promise.resolve(n.value).then(function(i){return{value:i,done:r}})}return F=function(n){this.s=n,this.n=n.next},F.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(n){var r=this.s.return;return r===void 0?Promise.resolve({value:n,done:!0}):t(r.apply(this.s,arguments))},throw:function(n){var r=this.s.return;return r===void 0?Promise.reject(n):t(r.apply(this.s,arguments))}},new F(e)}var K=async(e,t,n=e.name,r)=>{let i=[],s=[];var o,a=!1,l=!1;try{for(var u,c=function(f){var d,m,y,w=2;for(typeof Symbol<"u"&&(m=Symbol.asyncIterator,y=Symbol.iterator);w--;){if(m&&(d=f[m])!=null)return d.call(f);if(y&&(d=f[y])!=null)return new F(d.call(f));m="@@asyncIterator",y="@@iterator"}throw new TypeError("Object is not async iterable")}(e.values());a=!(u=await c.next()).done;a=!1){let f=u.value,d=`${n}/${f.name}`;f.kind==="file"?s.push(f.getFile().then(m=>(m.directoryHandle=e,m.handle=f,Object.defineProperty(m,"webkitRelativePath",{configurable:!0,enumerable:!0,get:()=>d})))):f.kind!=="directory"||!t||r&&r(f)||i.push(K(f,t,d,r))}}catch(f){l=!0,o=f}finally{try{a&&c.return!=null&&await c.return()}finally{if(l)throw o}}return[...(await Promise.all(i)).flat(),...await Promise.all(s)]},de=async(e={})=>{e.recursive=e.recursive||!1,e.mode=e.mode||"read";let t=await window.showDirectoryPicker({id:e.id,startIn:e.startIn,mode:e.mode});return(await(await t.values()).next()).done?[t]:K(t,e.recursive,void 0,e.skipDirectory)},fe={__proto__:null,default:de},me=async(e,t=[{}],n=null,r=!1,i=null)=>{Array.isArray(t)||(t=[t]),t[0].fileName=t[0].fileName||"Untitled";let s=[],o=null;if(e instanceof Blob&&e.type?o=e.type:e.headers&&e.headers.get("content-type")&&(o=e.headers.get("content-type")),t.forEach((u,c)=>{s[c]={description:u.description||"Files",accept:{}},u.mimeTypes?(c===0&&o&&u.mimeTypes.push(o),u.mimeTypes.map(f=>{s[c].accept[f]=u.extensions||[]})):o?s[c].accept[o]=u.extensions||[]:s[c].accept["*/*"]=u.extensions||[]}),n)try{await n.getFile()}catch(u){if(n=null,r)throw u}let a=n||await window.showSaveFilePicker({suggestedName:t[0].fileName,id:t[0].id,startIn:t[0].startIn,types:s,excludeAcceptAllOption:t[0].excludeAcceptAllOption||!1});!n&&i&&i(a);let l=await a.createWritable();return"stream"in e?(await e.stream().pipeTo(l),a):"body"in e?(await e.body.pipeTo(l),a):(await l.write(await e),await l.close(),a)},pe={__proto__:null,default:me},ye=async(e=[{}])=>(Array.isArray(e)||(e=[e]),new Promise((t,n)=>{let r=document.createElement("input");r.type="file";let i=[...e.map(l=>l.mimeTypes||[]),...e.map(l=>l.extensions||[])].join();r.multiple=e[0].multiple||!1,r.accept=i||"",r.style.display="none",document.body.append(r);let s=l=>{typeof o=="function"&&o(),t(l)},o=e[0].legacySetup&&e[0].legacySetup(s,()=>o(n),r),a=()=>{window.removeEventListener("focus",a),r.remove()};r.addEventListener("click",()=>{window.addEventListener("focus",a)}),r.addEventListener("change",()=>{window.removeEventListener("focus",a),r.remove(),s(r.multiple?Array.from(r.files):r.files[0])}),"showPicker"in HTMLInputElement.prototype?r.showPicker():r.click()})),he={__proto__:null,default:ye},ge=async(e=[{}])=>(Array.isArray(e)||(e=[e]),e[0].recursive=e[0].recursive||!1,new Promise((t,n)=>{let r=document.createElement("input");r.type="file",r.webkitdirectory=!0;let i=o=>{typeof s=="function"&&s(),t(o)},s=e[0].legacySetup&&e[0].legacySetup(i,()=>s(n),r);r.addEventListener("change",()=>{let o=Array.from(r.files);e[0].recursive?e[0].recursive&&e[0].skipDirectory&&(o=o.filter(a=>a.webkitRelativePath.split("/").every(l=>!e[0].skipDirectory({name:l,kind:"directory"})))):o=o.filter(a=>a.webkitRelativePath.split("/").length===2),i(o)}),"showPicker"in HTMLInputElement.prototype?r.showPicker():r.click()})),we={__proto__:null,default:ge},Se=async(e,t={})=>{Array.isArray(t)&&(t=t[0]);let n=document.createElement("a"),r=e;"body"in e&&(r=await async function(o,a){let l=o.getReader(),u=new ReadableStream({start:d=>async function m(){return l.read().then(({done:y,value:w})=>{if(!y)return d.enqueue(w),m();d.close()})}()}),c=new Response(u),f=await c.blob();return l.releaseLock(),new Blob([f],{type:a})}(e.body,e.headers.get("content-type"))),n.download=t.fileName||"Untitled",n.href=URL.createObjectURL(await r);let i=()=>{typeof s=="function"&&s()},s=t.legacySetup&&t.legacySetup(i,()=>s(),n);return n.addEventListener("click",()=>{setTimeout(()=>URL.revokeObjectURL(n.href),3e4),i()}),n.click(),null},ve={__proto__:null,default:Se};function E(e){return new Promise((t,n)=>{e.oncomplete=e.onsuccess=()=>t(e.result),e.onabort=e.onerror=()=>n(e.error)})}function Fe(e,t){let n=indexedDB.open(e);n.onupgradeneeded=()=>n.result.createObjectStore(t);let r=E(n);return(i,s)=>r.then(o=>s(o.transaction(t,i).objectStore(t)))}var D;function O(){return D||(D=Fe("keyval-store","keyval")),D}function H(e,t=O()){return t("readonly",n=>E(n.get(e)))}function b(e,t,n=O()){return n("readwrite",r=>(r.put(t,e),E(r.transaction)))}function G(e,t=O()){return t("readwrite",n=>(n.delete(e),E(n.transaction)))}P();var p=null;function ee(){return p}var te,Pe=new Promise(e=>{te=e});async function k(){let e=new URLSearchParams(location.search).get("storage");e!=="fs"&&e!=="idb"&&(e=void 0),e===void 0&&(p=await H("attached-dir"),!self.showDirectoryPicker||p===!1||!await ke()?(e="idb",p=null):e="fs"),FS.mkdirTree("/local"),e==="fs"?await I(p):FS.mount(IDBFS,{},"/local"),await ZC.fsSync(!0),FS.analyzePath("/local/zc.cfg").exists||FS.writeFile("/local/zc.cfg",FS.readFile("/zc_web.cfg")),FS.analyzePath("/local/zquest.cfg").exists||FS.writeFile("/local/zquest.cfg",FS.readFile("/zquest_web.cfg")),await q(),te()}async function ke(){let e={mode:"readwrite"};if(p){if(await p.queryPermission(e)==="granted")return!0;try{return await p.requestPermission(e)==="granted"}catch{}}document.querySelector(".content").classList.add("hidden"),document.querySelector(".permission").classList.remove("hidden"),document.querySelector(".permission .folder-name").textContent=p?.name,document.querySelector(".permission .already-attached").classList.toggle("hidden",!p),document.querySelector(".permission .not-attached").classList.toggle("hidden",!!p);let t=await new Promise(n=>{document.querySelector(".permission .ok").addEventListener("click",()=>{n(!0)}),document.querySelector(".permission .cancel").addEventListener("click",()=>{b("attached-dir",!1),n(!1)})});if(t&&!p)try{p=await self.showDirectoryPicker({id:"zc"})}catch{}return t&&p&&(t=await p.requestPermission(e)==="granted"),document.querySelector(".content").classList.remove("hidden"),document.querySelector(".permission").classList.add("hidden"),t}async function I(e){try{FS.unmount("/local")}catch{}p=e,e?await b("attached-dir",e):await G("attached-dir"),e&&(await Promise.resolve().then(()=>(J(),Le)),FS.mount(FSFS,{dirHandle:p},"/local"),await new Promise((t,n)=>FS.syncfs(!0,r=>{if(r)return n(r);t()})))}function ne(){let e=document.querySelector(".settings");e.querySelector(".settings__browser-files").addEventListener("click",async i=>{let s=i.target.closest("[data-path]");if(!s)return;let o=s.getAttribute("data-path"),a=new Blob([FS.readFile(o)]);await W(a,{fileName:o.replace("/local/","")})});let n=["zc.cfg","zquest.cfg","zc.sav"];async function r(i){await Pe;for(let s of i){let o;s.webkitRelativePath?o=[...PATH.dirname(s.webkitRelativePath).split("/").slice(1),PATH.basename(s.webkitRelativePath)].join("/"):o=s.name;let a="/local/"+o;if(FS.analyzePath(a).exists){let l="/local/.backup/"+o;FS.mkdirTree(PATH.dirname(l)),FS.writeFile(l,FS.readFile(a))}FS.mkdirTree(PATH.dirname(a)),FS.writeFile(a,new Uint8Array(await s.arrayBuffer()))}await ZC.fsSync(!1),i.some(s=>n.includes(s.name))&&window.location.reload(),await q()}e.querySelector(".settings__copy button.copy-folder").addEventListener("click",async()=>{let i=await N({recursive:!0});await r(i)}),e.querySelector(".settings__copy button.copy-file").addEventListener("click",async()=>{let i=await j();await r([i])}),e.querySelector(".settings__attach button.attach").addEventListener("click",async()=>{let i=await self.showDirectoryPicker({id:"zc"});await I(i),window.location.reload()}),e.querySelector(".settings__attach button.unattach").addEventListener("click",async()=>{await I(null),window.location.reload()})}async function q(){let e=document.querySelector(".settings"),t=!!self.showDirectoryPicker&&p;{e.querySelector(".settings__attach").classList.toggle("hidden",!t),e.querySelector(".settings__attach button.attach").classList.toggle("hidden",p);let r=e.querySelector(".settings__attach button.unattach");r.classList.toggle("hidden",!p),r.textContent=`Folder attached: ${p?.name}\u2013Click to unattach`}if(e.querySelector(".settings__copy").classList.toggle("hidden",t),!t){let n=e.querySelector(".settings__browser-files");n.innerHTML="";for(let{path:r,timestamp:i}of Y("/local")){let s=S("div","file");s.append(S("div","",r.replace("/local/",""))),s.append(S("div","",new Date(i).toLocaleString())),s.setAttribute("data-path",r),n.append(s)}}e.querySelector(".settings__download").classList.toggle("hidden",!!p);{let n=["zc.cfg","oot.cfg","2MGM.cfg","ultra.cfg","ppl160.cfg","freepats.cfg"],r=await H("timidity-cfg");(!r||!FS.analyzePath(`/etc/${r}`).exists)&&(r=n[0]);let i=e.querySelector(".settings__timidity-cfgs select");i.textContent="";for(let s of n){let o=S("option","",s);i.append(o)}i.addEventListener("change",async()=>{await b("timidity-cfg",i.value)}),i.value=r,FS.writeFile("/etc/timidity.cfg",FS.readFile(`/etc/${r}`))}}P();function re(e){alert(e),window.location.reload()}async function ie(){if(!(window.launchQueue&&"files"in LaunchParams.prototype)){document.body.textContent="This page is only for opening files from an installed PWA";return}await k();let e=ee();if(!e){re("Sorry, you can only open files this way if you've attached a folder. See Settings");return}document.querySelector(".content").classList.add("hidden"),document.querySelector(".file-handler").classList.remove("hidden");let t=await new Promise((o,a)=>{launchQueue.setConsumer(async l=>{if(console.log("...",l.files),!l.files.length){a(new Error("No files found"));return}o(l.files[0])})}),n=await e.resolve(t);if(!n){re("Sorry, but that file is not inside the attached folder and cannot be opened directly");return}let i=`local/${n.join("/")}`,s=await new Promise(o=>{document.querySelectorAll(".file-handler button")[0].addEventListener("click",()=>{o(!1)}),document.querySelectorAll(".file-handler button")[1].addEventListener("click",()=>{o(!0)})});return document.querySelector(".content").classList.remove("hidden"),document.querySelector(".file-handler").classList.add("hidden"),{openInEditor:s,quest:i}}var Ne=Z({});window.ZC={dataOrigin:"https://zc-data.nyc3.digitaloceanspaces.com",pathToUrl:{},setStatus:function(e,t=null){if(e.startsWith("Downloading data... (")){let[,s,o]=e.match(/(\d+)\/(\d+)/);e=`Downloading data... (${L(s,o,"MB")})`,t=s/o}if(!e||e==="Running...")return;ZC.setStatus.last||(ZC.setStatus.last={time:Date.now(),text:""});let n=document.getElementById("status"),r=document.getElementById("progress");if(e==="Ready"){r.value=null,r.max=null,r.hidden=!0,n.hidden=!0;return}if(n.hidden=!1,e===ZC.setStatus.last.text)return;let i=Date.now();t&&i-ZC.setStatus.last.time<30||(ZC.setStatus.last.time=i,ZC.setStatus.last.text=e,t!==null&&t>0?(r.value=t,r.max=1,r.hidden=!1):(r.value=null,r.max=null,r.hidden=!0),n.innerHTML=e)},async fetch(e,t){let n=await Q(e,t,(i,s,o)=>{o?ZC.setStatus("Ready"):i&&s?ZC.setStatus(`Fetching file (${L(i,s)})`,i/s):i?ZC.setStatus(`Fetching file (${L(i)})`):ZC.setStatus("Fetching file")});if(await n.headers.get("Content-Type")==="application/json"||e.endsWith(".json")){let i=new TextDecoder("utf-8").decode(await n.arrayBuffer());return JSON.parse(i)}return n},async getQuestManifest(){return ZC.questManifestPromise||(ZC.questManifestPromise=ZC.fetch(ZC.dataOrigin+"/manifest.json").catch(e=>(console.error(e.toString()),[]))),ZC.questManifestPromise},async fetchAsByteArray(e,t){let n=await ZC.fetch(e,t);return new Uint8Array(await n.arrayBuffer())},url:"",setShareableUrl(e){ZC.url=v("",e)},openTestMode(e,t,n,r){if(128<n)return;let i={test:e,dmap:t,screen:n};r!==-1&&(i.retsquare=r);let s=v(ZC_Constants.zeldaUrl,i);window.open(s,"_blank")},async runZscriptCompiler(e,t,n){e=PATH.join("/root-fs",e),t=PATH.join("/root-fs",t);let{default:r}=await Ne("./zscript.mjs"+(Math.random(),"")),i,s=new Promise(a=>i=a);await r({preRun(a){FS.analyzePath("/local/zscript.cfg").exists||FS.writeFile("/local/zscript.cfg",""),a.FS.mkdir("/root-fs"),a.FS.mount(PROXYFS,{root:"/",fs:FS},"/root-fs"),a.FS.chdir("/root-fs")},onExit:i,arguments:["-linked","-input",e,"-console",t,"-qr",n]});let o=await s;return await new Promise(a=>setTimeout(a,100)),{code:o}},async fsSync(e){await new Promise((t,n)=>FS.syncfs(e,r=>{if(r)return n(r);t()}))},configureMount:k};async function qe(){window.Module=window.Module||{},Module.noInitialRun=!0;let e,t=new Promise(o=>e=o);window.Module=Object.assign(Module,{arguments:[],canvas:document.querySelector("canvas"),instantiateWasm:_e,onRuntimeInitialized:()=>{if(TARGET==="zplayer")xe();else for(let o of[...document.querySelectorAll(".touch-inputs")])o.classList.toggle("hidden",!0);Ce(),ne(),TARGET==="zeditor"&&Me(),e()},setStatus:function(o,a=null){ZC.setStatus(o,a)},expectedDataFileDownloads:0,totalDependencies:0,monitorRunDependencies:function(o){if(Module.totalDependencies=Math.max(Module.totalDependencies,o),Module.totalDependencies===1)return;let a=(Module.totalDependencies-o)/Module.totalDependencies;ZC.setStatus(o?`Preparing... (${Module.totalDependencies-o}/${Module.totalDependencies})`:"",a)},onExit:function(o){let a=`exit with code: ${o}`;o===0?console.log(a):console.error(a)},preRun:[()=>{IS_CI&&(ENV.CI="1")}],locateFile:function(o,a){return new URL(o,a||rootUrl).href}});let n=new URLSearchParams(location.search),r=Module.arguments,i=n.get("open");if(i){let o=await ZC.getQuestManifest();i=i.startsWith("/")?i:`/${i}`;let a=(i.startsWith("/quests/")||i.startsWith("/tilesets/"))&&i.match(/\/([^/]*\/[^/]*\/[^/]*)\/?(.*)?/);if(a){let[,l,u]=a;!u&&o[l]&&(i=`/${o[l].defaultPath}`)}}if(i&&(TARGET==="zeditor"?r.push(i):TARGET==="zplayer"&&r.push("-web-open",i)),TARGET==="zplayer"){let o=n.get("test"),a=n.get("screen"),l=n.get("dmap"),u=n.get("retsquare");o&&a&&l&&(r.push("-test",o,l,a),u&&r.push(u),document.querySelector(".button--testmode").classList.remove("hidden"))}for(let[o,a]of n.entries()){if(["test","screen","dmap","retsquare","open"].includes(o))continue;let l="-"+o.replace(/[A-Z]/g,(u,c)=>(c>0?"-":"")+u.toLowerCase());r.push(l),a!==""&&r.push(a)}window.addEventListener("resize",z),z();let s=()=>{navigator.storage.persist(),canvas.removeEventListener("click",s)};canvas.addEventListener("click",s);for(let o of[...document.querySelectorAll(".panel-button[data-panel]")])o.addEventListener("click",async()=>{for(let l of document.querySelectorAll(".panel-button")){let u=document.querySelector(l.getAttribute("data-panel"));o===l?(l.classList.toggle("active"),u&&u.classList.toggle("hidden"),u&&l.getAttribute("data-panel")===".settings"&&await q()):(l.classList.remove("active"),u&&u.classList.add("hidden"))}let a=!document.querySelector(".panel-button.active");document.body.classList.toggle("canvas-focus",a),document.querySelector(".content").classList.toggle("hidden",!a),a&&(z(),document.body.scrollIntoView())});if(document.body.classList.toggle("canvas-focus",!0),await t,callMain(Module.arguments),await Ae(),n.has("launch")){let o=await ie();o.openInEditor?window.location.href=v(ZC_Constants.zquestUrl,{open:o.quest}):window.location.href=v(ZC_Constants.zeldaUrl,{open:o.quest})}}function _e(e,t){function n(i){return getBinaryPromise().then(function(s){return WebAssembly.instantiate(s,e)}).then(function(s){return s}).then(i,function(s){err("failed to asynchronously prepare wasm: "+s),isFileURI(wasmBinaryFile)&&err("warning: Loading from a file URI ("+wasmBinaryFile+") is not supported in most browsers. See https://emscripten.org/docs/getting_started/FAQ.html#how-do-i-run-a-local-webserver-for-testing-why-does-my-program-stall-in-downloading-or-preparing"),abort(s)})}function r(i){t(i.instance,i.module)}return!wasmBinary&&typeof WebAssembly.instantiateStreaming=="function"&&!isDataURI(wasmBinaryFile)&&!isFileURI(wasmBinaryFile)&&typeof fetch=="function"?fetch(wasmBinaryFile,{credentials:"same-origin"}).then(function(i){var s=WebAssembly.instantiateStreaming(i,e);return s.then(r,function(o){return err("wasm streaming compile failed: "+o),err("falling back to ArrayBuffer instantiation"),n(r)})}):n(r)}function z(){let e=640,t=480,n=innerHeight-document.querySelector("header").clientHeight,r=Math.min(innerWidth/e,n/t);canvas.style.width=Math.floor(e*r)+"px",canvas.style.height=Math.floor(t*r)+"px"}async function Ae(){let e=document.querySelector(".quest-list"),t=e.querySelector(".quest-list__entries-list"),n=e.querySelector(".quest-list__current"),r=document.querySelector(".tmpl-selected-quest"),i=await ZC.getQuestManifest(),s=Object.values(i);for(let c of s){if(c.type!=="quests"||!["auto",!0].includes(c.approval))continue;let f=document.createElement("div");f.classList.add("quest-list__entry"),f.setAttribute("data-quest-index",s.indexOf(c)),f.quest=c,f.append(c.name),t.append(f),f.tabIndex=-1}t.addEventListener("keyup",c=>{if(c.keyCode===38){let f=Number(c.target.previousElementSibling.getAttribute("data-quest-index")),d=s[f];o(d),c.target.previousElementSibling.focus()}else if(c.keyCode===40&&c.target.nextElementSibling){let f=Number(c.target.nextElementSibling.getAttribute("data-quest-index")),d=s[f];o(d),c.target.nextElementSibling.focus()}});function o(c){let f=`${ZC.dataOrigin}/${c.id}`;document.querySelector(".quest-list__entry.selected")?.classList.remove("selected"),document.querySelector(`.quest-list__entry[data-quest-index="${s.indexOf(c)}"]`).classList.add("selected");let d=r.content.cloneNode(!0).children[0];function m(h,g){g?d.querySelector(h).textContent=g:d.querySelector(h).parentElement.remove()}m(".name",c.name),m(".author",c.authors.map(h=>h.name).join(", ")),m(".genre",c.genre),m(".version",c.version),c.projectUrl?d.querySelector(".purezc-link").href=c.projectUrl:d.querySelector(".purezc-link").remove(),c.rating?(d.querySelector(".rating").textContent=c.rating.score,d.querySelector(".rating-votes").textContent=c.rating.distribution.reduce((h,g)=>h+g,0)):d.querySelector("._rating").remove(),c.informationHtml&&(d.querySelector(".information").innerHTML=c.informationHtml),c.descriptionHtml&&(d.querySelector(".description").innerHTML=c.descriptionHtml),c.storyHtml&&(d.querySelector(".story").innerHTML=c.storyHtml),c.tipsAndCheatsHtml&&(d.querySelector(".tips").innerHTML=c.tipsAndCheatsHtml),c.creditsHtml&&(d.querySelector(".credits").innerHTML=c.creditsHtml);function y(h){let g=document.createElement("img");g.crossOrigin="anonymous",g.src=`${f}/${h}`,d.querySelector(".current-image").innerHTML="",d.querySelector(".current-image").append(g)}let w=d.querySelector(".images");if(c.images.length>1)for(let h of c.images){let g=document.createElement("img");g.crossOrigin="anonymous",g.src=`${f}/${h}`,w.append(g),g.addEventListener("click",()=>{y(h)}),g.addEventListener("mouseover",()=>{y(h)})}c.images.length>0&&y(c.images[0]);let A=c.releases[0],x=A.resources.filter(h=>h.endsWith(".qst"));for(let h of x){let C={open:x.length>1?`${c.id}/${A.name}/${h}`:c.id};x.length===1&&(C.name=c.name.replace(/['!?]/g,"").replace(/[\s:&]+/g,"-").replace(/[-]+/g,"-"));let M=S("a","play-link");M.href=v(ZC_Constants.zeldaUrl,C),M.textContent="Play!";let T=S("a");T.href=v(ZC_Constants.zquestUrl,C),T.textContent="Open in Editor";let $=S("div","link-group");d.querySelector(".links").append($),$.append(h,M,T)}n.textContent="",n.append(d)}t.addEventListener("click",c=>{let f=c.target.closest(".quest-list__entry");if(!f)return;let d=Number(f.getAttribute("data-quest-index")),m=s[d];o(m)});for(let c of document.querySelectorAll(".quest-list__sort-option"))c.addEventListener("click",()=>{let f=c.textContent,d;f==="Name"?d=(m,y)=>m.textContent.localeCompare(y.textContent):f==="Rating"&&(d=(m,y)=>{let w=m.quest.rating?.score||0;return(y.quest.rating?.score||0)-w}),[...t.children].sort(d).forEach(m=>t.appendChild(m))});let a=new URLSearchParams(location.search).get("quest"),l=a?a.match(/(quests\/purezc\/\d+)/)?.[0]:"",u=l&&s.find(c=>c.id==l)||s.find(c=>["auto",!0].includes(c.approval));u&&o(u)}function xe(){let e=Module.cwrap("create_synthetic_key_event",null,["int","int"]),t={KEY_DOWN:10,KEY_CHAR:11,KEY_UP:12},n={B:26,A:24,Start:67,Map:75,L:1,R:19,Left:82,Right:83,Down:84,Up:85},r=(o,a)=>{if(o===-1)return n.Left;if(o===1)return n.Right;if(a===-1)return n.Down;if(a===1)return n.Up},i=(o,a)=>{o==="touchstart"&&e(t.KEY_DOWN,a),(o==="touchmove"||o==="touchstart")&&e(t.KEY_CHAR,a),o==="touchend"&&e(t.KEY_UP,a)},s=o=>{let a=o.getAttribute("data-action");if(a)return[n[a]];let l=[],u=Number(o.getAttribute("data-x")),c=Number(o.getAttribute("data-y"));return u&&l.push(r(u,0)),c&&l.push(r(0,c)),l};for(let o of document.querySelectorAll(".touch-inputs")){let a=null,l=c=>{a&&a.classList.remove("pressed"),a=c,a&&a.classList.add("pressed")},u=(c,f)=>{let d;if(c==="touchend"){if(f.targetTouches.length!==0)return;d=f.changedTouches[0]}else{if(f.targetTouches.length!==1)return;d=f.targetTouches[0]}let m=document.elementFromPoint(d.clientX,d.clientY),y=m.classList.contains("touch-input")?m:null;if(!(!y&&m.closest(".touch-inputs")===o&&c!=="touchend")){if(a&&(y!==a||!y))for(let w of s(a))i("touchend",w);if(!y){l(null);return}for(let w of s(y))i(c,w);l(c==="touchend"?null:y)}};o.addEventListener("touchstart",c=>u("touchstart",c)),o.addEventListener("touchmove",c=>u("touchmove",c)),o.addEventListener("touchend",c=>u("touchend",c)),o.addEventListener("touchcancel",c=>u("touchend",c)),o.addEventListener("contextmenu",c=>c.preventDefault())}}function Ce(){let e=document.querySelector(".button--copyurl");e.classList.remove("hidden");let t=Module.cwrap("get_shareable_url","undefined",[]);e.addEventListener("click",()=>{t(),ZC.url&&navigator.clipboard.writeText(ZC.url)})}function Me(){let e=document.querySelector(".button--open-testmode");e.classList.remove("hidden");let t=Module.cwrap("open_test_mode",null,[]);e.addEventListener("click",()=>{t()})}function U(){let e=navigator.getGamepads().some(Boolean);for(let t of[...document.querySelectorAll(".touch-inputs")])t.classList.toggle("hidden",e)}function Te(){document.querySelector("main").requestFullscreen()}qe().catch(e=>{console.error(e),document.querySelector(".content").textContent=e.toString()});U();window.addEventListener("gamepadconnected",U);window.addEventListener("gamepaddisconnected",U);var _=document.createElement("button");_.textContent="Fullscreen";_.classList.add("panel-button");_.addEventListener("click",Te);document.addEventListener("DOMContentLoaded",()=>{document.querySelector(".panel-buttons").append(_)});})();
//# sourceMappingURL=main.js.map
