{
  "version": 3,
  "sources": ["../../web/utils.js", "../../web/fsfs.js", "../../web/node_modules/browser-fs-access/dist/index.modern.js", "../../web/node_modules/idb-keyval/dist/index.js", "../../web/settings.js", "../../web/main.js", "../../web/file_launch.js"],
  "sourcesContent": ["export async function fetchWithProgress(url, opts, progressCb) {\n  const response = await fetch(url, opts);\n\n  // Fetch API cannot tell how much of a compressed request's bytes have been downloaded.\n  // We only get the response, post-uncompression.\n  // But let's still display the progress in terms of transfer size, so it does not seem\n  // like more is being downloaded than in reality.\n  // This progress bar won't be totally accurate (compression ratios vary for a given response),\n  // but it should be good enough.\n\n  const contentLength = Number(response.headers.get('Content-Length'));\n  const inflatedContentLength = response.headers.has('Content-Encoding') ?\n    Number(response.headers.get('X-Amz-Meta-Inflated-Content-Size')) :\n    null;\n\n  let transferSize = contentLength;\n  if (!Number.isInteger(contentLength) || !Number.isFinite(contentLength) || contentLength <= 0) {\n    transferSize = null;\n  }\n\n  const compressionRatio =\n    inflatedContentLength && transferSize ? transferSize / inflatedContentLength : 1;\n\n  let responseBytesRecieved = 0;\n  return new Response(new ReadableStream({\n    async start(controller) {\n      const reader = response.body.getReader();\n      while (true) {\n        const { done, value } = await reader.read();\n\n        if (done) {\n          progressCb(responseBytesRecieved * compressionRatio, transferSize, true);\n          break;\n        }\n\n        responseBytesRecieved += value.byteLength;\n        progressCb(responseBytesRecieved * compressionRatio, transferSize, false);\n        controller.enqueue(value);\n      }\n      controller.close();\n    },\n  }), {\n    status: response.status,\n    statusText: response.statusText,\n    headers: response.headers,\n  });\n}\n\nexport function createUrlString(pathname, params) {\n  const url = new URL(pathname, location.href);\n  url.search = '';\n\n  for (let [key, value] of Object.entries(params)) {\n    if (key === 'open') {\n      if (value.startsWith('/')) value = value.substr(1);\n    }\n    url.searchParams.set(key, value);\n  }\n\n  // Make friendly.\n  url.search = decodeURIComponent(url.search);\n  return url.toString();\n}\n\nexport function fsReadAllFiles(folder) {\n  const files = [];\n  if (!FS.analyzePath(folder).exists) return files;\n\n  function impl(curFolder) {\n    for (const name of FS.readdir(curFolder)) {\n      if (name === '.' || name === '..') continue;\n\n      const path = `${curFolder}/${name}`;\n      const { mode, timestamp } = FS.lookupPath(path).node;\n      if (FS.isFile(mode)) {\n        files.push({ path, timestamp });\n      } else if (FS.isDir(mode)) {\n        impl(path);\n      }\n    }\n  }\n\n  impl(folder);\n  return files;\n}\n\nexport function createElement(tagName, className, textContent) {\n  const el = document.createElement(tagName);\n  if (className) el.className = className;\n  el.textContent = textContent;\n  return el;\n}\n\nexport const getFsHandles = async (dirHandle) => {\n  const handles = [];\n\n  async function collect(curDirHandle) {\n    for await (const entry of curDirHandle.values()) {\n      handles.push(entry);\n      if (entry.kind === 'directory') {\n        await collect(entry);\n      }\n    }\n  }\n\n  await collect(dirHandle);\n\n  const result = new Map();\n  result.set('.', dirHandle);\n  for (const handle of handles) {\n    const relativePath = (await dirHandle.resolve(handle)).join('/');\n    result.set(relativePath, handle);\n  }\n  return result;\n};\n\nexport function formatBytes(bytes1, bytes2, unit) {\n  const b = (bytes2 || bytes1);\n  let scale = 1;\n  let fixedUnits = 0;\n\n  if (unit === undefined) {\n    if (b > 1024 ** 2) {\n      unit = 'MB';\n    } else if (b > 1024) {\n      unit = 'KB';\n    } else {\n      unit = 'B';\n    }\n  }\n\n  if (unit === 'B') {\n    scale = 1;\n    fixedUnits = 0;\n  } else if (unit === 'KB') {\n    scale = 1024;\n    fixedUnits = 0;\n  } else if (unit === 'MB') {\n    scale = 1024 ** 2;\n    fixedUnits = 1;\n  }\n\n  if (bytes2 === undefined) {\n    return `${(bytes1 / scale).toFixed(fixedUnits)} ${unit}`\n  }\n\n  return `${(bytes1 / scale).toFixed(fixedUnits)}/${(bytes2 / scale).toFixed(fixedUnits)} ${unit}`\n}\n", "// Very similar to https://github.com/emscripten-core/emscripten/blob/main/src/library_idbfs.js\n\nimport { getFsHandles } from \"./utils.js\";\n\nconst LibraryManager = {library: {}};\n\nfunction mergeInto(obj, other) {\n  return Object.assign(obj, other);\n}\n\nmergeInto(LibraryManager.library, {\n  $FSFS__deps: ['$FS', '$MEMFS', '$PATH'],\n  $FSFS__postset: function() {\n    return '';\n  },\n  $FSFS: {\n    // DIR_MODE: {{{ cDefine('S_IFDIR') }}} | 511 /* 0777 */,\n    // FILE_MODE: {{{ cDefine('S_IFREG') }}} | 511 /* 0777 */,\n    DIR_MODE: 16384 | 511,\n    FILE_MODE: 32768 | 511,\n    mount: function(mount) {\n      if (!mount.opts.dirHandle) {\n        throw new Error('opts.dirHandle is required');\n      }\n\n      // reuse all of the core MEMFS functionality\n      return MEMFS.mount.apply(null, arguments);\n    },\n    syncfs: async (mount, populate, callback) => {\n      try {\n        const local = await FSFS.getLocalSet(mount);\n        const remote = await FSFS.getRemoteSet(mount);\n        const src = populate ? remote : local;\n        const dst = populate ? local : remote;\n        await FSFS.reconcile(mount, src, dst);\n        callback(null);\n      } catch (e) {\n        callback(e);\n      }\n    },\n    // Returns file set of emscripten's filesystem at the mountpoint.\n    getLocalSet: (mount) => {\n      var entries = Object.create(null);\n\n      function isRealDir(p) {\n        return p !== '.' && p !== '..';\n      };\n      function toAbsolute(root) {\n        return (p) => {\n          return PATH.join2(root, p);\n        }\n      };\n\n      var check = FS.readdir(mount.mountpoint).filter(isRealDir).map(toAbsolute(mount.mountpoint));\n\n      while (check.length) {\n        var path = check.pop();\n        var stat = FS.stat(path);\n\n        if (FS.isDir(stat.mode)) {\n          check.push.apply(check, FS.readdir(path).filter(isRealDir).map(toAbsolute(path)));\n        }\n\n        entries[path] = { timestamp: stat.mtime, mode: stat.mode };\n      }\n\n      return { type: 'local', entries: entries };\n    },\n    // Returns file set of the real, on-disk filesystem at the mountpoint.\n    getRemoteSet: async (mount) => {\n      // TODO: this should be a map.\n      const entries = Object.create(null);\n\n      const handles = await getFsHandles(mount.opts.dirHandle, true);\n      for (const [path, handle] of handles) {\n        if (path === '.') continue;\n\n        entries[PATH.join2(mount.mountpoint, path)] = {\n          timestamp: handle.kind === 'file' ? (await handle.getFile()).lastModifiedDate : new Date(),\n          mode: handle.kind === 'file' ? FSFS.FILE_MODE : FSFS.DIR_MODE,\n        };\n      }\n\n      return { type: 'remote', entries, handles };\n    },\n    loadLocalEntry: (path) => {\n      const lookup = FS.lookupPath(path);\n      const node = lookup.node;\n      const stat = FS.stat(path);      \n\n      if (FS.isDir(stat.mode)) {\n        return { 'timestamp': stat.mtime, 'mode': stat.mode };\n      } else if (FS.isFile(stat.mode)) {\n        node.contents = MEMFS.getFileDataAsTypedArray(node);\n        return { timestamp: stat.mtime, mode: stat.mode, contents: node.contents };\n      } else {\n        throw new Error('node type not supported');\n      }\n    },\n    storeLocalEntry: (path, entry) => {\n      if (FS.isDir(entry['mode'])) {\n        FS.mkdirTree(path, entry['mode']);\n      } else if (FS.isFile(entry['mode'])) {\n        FS.writeFile(path, entry['contents'], { canOwn: true });\n      } else {\n        throw new Error('node type not supported');\n      }\n\n      FS.chmod(path, entry['mode']);\n      FS.utime(path, entry['timestamp'], entry['timestamp']);\n    },\n    removeLocalEntry: (path) => {\n      var stat = FS.stat(path);\n\n      if (FS.isDir(stat.mode)) {\n        FS.rmdir(path);\n      } else if (FS.isFile(stat.mode)) {\n        FS.unlink(path);\n      }\n    },\n    loadRemoteEntry: async (handle) => {\n      if (handle.kind === 'file') {\n        const file = await handle.getFile();\n        return {\n          contents: new Uint8Array(await file.arrayBuffer()),\n          mode: FSFS.FILE_MODE,\n          timestamp: file.lastModifiedDate,\n        };\n      } else if (handle.kind === 'directory') {\n        return {\n          mode: FSFS.DIR_MODE,\n          timestamp: new Date(),\n        };\n      } else {\n        throw new Error('unknown kind: ' + handle.kind);\n      }\n    },\n    storeRemoteEntry: async (handles, path, entry) => {\n      const parentDirHandle = handles.get(PATH.dirname(path));\n      const handle = FS.isFile(entry.mode) ?\n        await parentDirHandle.getFileHandle(PATH.basename(path), {create: true}) :\n        await parentDirHandle.getDirectoryHandle(PATH.basename(path), {create: true});\n      if (handle.kind === 'file') {\n        const writable = await handle.createWritable();\n        await writable.write(entry.contents);\n        await writable.close();\n      }\n      handles.set(path, handle);\n    },\n    removeRemoteEntry: async (handles, path) => {\n      const parentDirHandle = handles.get(PATH.dirname(path));\n      await parentDirHandle.removeEntry(PATH.basename(path));\n      handles.delete(path);\n    },\n    reconcile: async (mount, src, dst) => {\n      let total = 0;\n\n      const create = [];\n      Object.keys(src.entries).forEach(function (key) {\n        const e = src.entries[key];\n        const e2 = dst.entries[key];\n        if (!e2 || (FS.isFile(e.mode) && e['timestamp'].getTime() > e2['timestamp'].getTime())) {\n          create.push(key);\n          total++;\n        }\n      });\n      // sort paths in ascending order so directory entries are created\n      // before the files inside them\n      create.sort();\n\n      const remove = [];\n      Object.keys(dst.entries).forEach(function (key) {\n        if (!src.entries[key]) {\n          remove.push(key);\n          total++;\n        }\n      });\n      // sort paths in descending order so files are deleted before their\n      // parent directories\n      remove.sort().reverse();\n\n      if (!total) {\n        return;\n      }\n\n      const handles = src.type === 'remote' ? src.handles : dst.handles;\n\n      for (const path of create) {\n        const relPath = PATH.normalize(path.replace(mount.mountpoint, '/')).substring(1);;\n        if (dst.type === 'local') {\n          const handle = handles.get(relPath);\n          const entry = await FSFS.loadRemoteEntry(handle);\n          FSFS.storeLocalEntry(path, entry);\n        } else {\n          const entry = FSFS.loadLocalEntry(path);\n          await FSFS.storeRemoteEntry(handles, relPath, entry);\n        }\n      }\n\n      for (const path of remove) {\n        if (dst.type === 'local') {\n          FSFS.removeLocalEntry(path);\n        } else {\n          const relPath = PATH.normalize(path.replace(mount.mountpoint, '/')).substring(1);\n          await FSFS.removeRemoteEntry(handles, relPath);\n        }\n      }\n    }\n  }\n});\n\nglobalThis.FSFS = LibraryManager.library.$FSFS;\nFS.filesystems.FSFS = FSFS;\n", "const e=(()=>{if(\"undefined\"==typeof self)return!1;if(\"top\"in self&&self!==top)try{top.window.document._=0}catch(e){return!1}return\"showOpenFilePicker\"in self})(),t=e?Promise.resolve().then(function(){return l}):Promise.resolve().then(function(){return v});async function n(...e){return(await t).default(...e)}const r=e?Promise.resolve().then(function(){return y}):Promise.resolve().then(function(){return b});async function i(...e){return(await r).default(...e)}const a=e?Promise.resolve().then(function(){return m}):Promise.resolve().then(function(){return k});async function o(...e){return(await a).default(...e)}const s=async e=>{const t=await e.getFile();return t.handle=e,t};var c=async(e=[{}])=>{Array.isArray(e)||(e=[e]);const t=[];e.forEach((e,n)=>{t[n]={description:e.description||\"Files\",accept:{}},e.mimeTypes?e.mimeTypes.map(r=>{t[n].accept[r]=e.extensions||[]}):t[n].accept[\"*/*\"]=e.extensions||[]});const n=await window.showOpenFilePicker({id:e[0].id,startIn:e[0].startIn,types:t,multiple:e[0].multiple||!1,excludeAcceptAllOption:e[0].excludeAcceptAllOption||!1}),r=await Promise.all(n.map(s));return e[0].multiple?r:r[0]},l={__proto__:null,default:c};function u(e){function t(e){if(Object(e)!==e)return Promise.reject(new TypeError(e+\" is not an object.\"));var t=e.done;return Promise.resolve(e.value).then(function(e){return{value:e,done:t}})}return u=function(e){this.s=e,this.n=e.next},u.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var n=this.s.return;return void 0===n?Promise.resolve({value:e,done:!0}):t(n.apply(this.s,arguments))},throw:function(e){var n=this.s.return;return void 0===n?Promise.reject(e):t(n.apply(this.s,arguments))}},new u(e)}const p=async(e,t,n=e.name,r)=>{const i=[],a=[];var o,s=!1,c=!1;try{for(var l,d=function(e){var t,n,r,i=2;for(\"undefined\"!=typeof Symbol&&(n=Symbol.asyncIterator,r=Symbol.iterator);i--;){if(n&&null!=(t=e[n]))return t.call(e);if(r&&null!=(t=e[r]))return new u(t.call(e));n=\"@@asyncIterator\",r=\"@@iterator\"}throw new TypeError(\"Object is not async iterable\")}(e.values());s=!(l=await d.next()).done;s=!1){const o=l.value,s=`${n}/${o.name}`;\"file\"===o.kind?a.push(o.getFile().then(t=>(t.directoryHandle=e,t.handle=o,Object.defineProperty(t,\"webkitRelativePath\",{configurable:!0,enumerable:!0,get:()=>s})))):\"directory\"!==o.kind||!t||r&&r(o)||i.push(p(o,t,s,r))}}catch(e){c=!0,o=e}finally{try{s&&null!=d.return&&await d.return()}finally{if(c)throw o}}return[...(await Promise.all(i)).flat(),...await Promise.all(a)]};var d=async(e={})=>{e.recursive=e.recursive||!1,e.mode=e.mode||\"read\";const t=await window.showDirectoryPicker({id:e.id,startIn:e.startIn,mode:e.mode});return(await(await t.values()).next()).done?[t]:p(t,e.recursive,void 0,e.skipDirectory)},y={__proto__:null,default:d},f=async(e,t=[{}],n=null,r=!1,i=null)=>{Array.isArray(t)||(t=[t]),t[0].fileName=t[0].fileName||\"Untitled\";const a=[];let o=null;if(e instanceof Blob&&e.type?o=e.type:e.headers&&e.headers.get(\"content-type\")&&(o=e.headers.get(\"content-type\")),t.forEach((e,t)=>{a[t]={description:e.description||\"Files\",accept:{}},e.mimeTypes?(0===t&&o&&e.mimeTypes.push(o),e.mimeTypes.map(n=>{a[t].accept[n]=e.extensions||[]})):o?a[t].accept[o]=e.extensions||[]:a[t].accept[\"*/*\"]=e.extensions||[]}),n)try{await n.getFile()}catch(e){if(n=null,r)throw e}const s=n||await window.showSaveFilePicker({suggestedName:t[0].fileName,id:t[0].id,startIn:t[0].startIn,types:a,excludeAcceptAllOption:t[0].excludeAcceptAllOption||!1});!n&&i&&i(s);const c=await s.createWritable();if(\"stream\"in e){const t=e.stream();return await t.pipeTo(c),s}return\"body\"in e?(await e.body.pipeTo(c),s):(await c.write(await e),await c.close(),s)},m={__proto__:null,default:f},w=async(e=[{}])=>(Array.isArray(e)||(e=[e]),new Promise((t,n)=>{const r=document.createElement(\"input\");r.type=\"file\";const i=[...e.map(e=>e.mimeTypes||[]),...e.map(e=>e.extensions||[])].join();r.multiple=e[0].multiple||!1,r.accept=i||\"\",r.style.display=\"none\",document.body.append(r);const a=e=>{\"function\"==typeof o&&o(),t(e)},o=e[0].legacySetup&&e[0].legacySetup(a,()=>o(n),r),s=()=>{window.removeEventListener(\"focus\",s),r.remove()};r.addEventListener(\"click\",()=>{window.addEventListener(\"focus\",s)}),r.addEventListener(\"change\",()=>{window.removeEventListener(\"focus\",s),r.remove(),a(r.multiple?Array.from(r.files):r.files[0])}),\"showPicker\"in HTMLInputElement.prototype?r.showPicker():r.click()})),v={__proto__:null,default:w},h=async(e=[{}])=>(Array.isArray(e)||(e=[e]),e[0].recursive=e[0].recursive||!1,new Promise((t,n)=>{const r=document.createElement(\"input\");r.type=\"file\",r.webkitdirectory=!0;const i=e=>{\"function\"==typeof a&&a(),t(e)},a=e[0].legacySetup&&e[0].legacySetup(i,()=>a(n),r);r.addEventListener(\"change\",()=>{let t=Array.from(r.files);e[0].recursive?e[0].recursive&&e[0].skipDirectory&&(t=t.filter(t=>t.webkitRelativePath.split(\"/\").every(t=>!e[0].skipDirectory({name:t,kind:\"directory\"})))):t=t.filter(e=>2===e.webkitRelativePath.split(\"/\").length),i(t)}),\"showPicker\"in HTMLInputElement.prototype?r.showPicker():r.click()})),b={__proto__:null,default:h},P=async(e,t={})=>{Array.isArray(t)&&(t=t[0]);const n=document.createElement(\"a\");let r=e;\"body\"in e&&(r=await async function(e,t){const n=e.getReader(),r=new ReadableStream({start:e=>async function t(){return n.read().then(({done:n,value:r})=>{if(!n)return e.enqueue(r),t();e.close()})}()}),i=new Response(r),a=await i.blob();return n.releaseLock(),new Blob([a],{type:t})}(e.body,e.headers.get(\"content-type\"))),n.download=t.fileName||\"Untitled\",n.href=URL.createObjectURL(await r);const i=()=>{\"function\"==typeof a&&a()},a=t.legacySetup&&t.legacySetup(i,()=>a(),n);return n.addEventListener(\"click\",()=>{setTimeout(()=>URL.revokeObjectURL(n.href),3e4),i()}),n.click(),null},k={__proto__:null,default:P};export{i as directoryOpen,h as directoryOpenLegacy,d as directoryOpenModern,n as fileOpen,w as fileOpenLegacy,c as fileOpenModern,o as fileSave,P as fileSaveLegacy,f as fileSaveModern,e as supported};\n", "function promisifyRequest(request) {\n    return new Promise((resolve, reject) => {\n        // @ts-ignore - file size hacks\n        request.oncomplete = request.onsuccess = () => resolve(request.result);\n        // @ts-ignore - file size hacks\n        request.onabort = request.onerror = () => reject(request.error);\n    });\n}\nfunction createStore(dbName, storeName) {\n    const request = indexedDB.open(dbName);\n    request.onupgradeneeded = () => request.result.createObjectStore(storeName);\n    const dbp = promisifyRequest(request);\n    return (txMode, callback) => dbp.then((db) => callback(db.transaction(storeName, txMode).objectStore(storeName)));\n}\nlet defaultGetStoreFunc;\nfunction defaultGetStore() {\n    if (!defaultGetStoreFunc) {\n        defaultGetStoreFunc = createStore('keyval-store', 'keyval');\n    }\n    return defaultGetStoreFunc;\n}\n/**\n * Get a value by its key.\n *\n * @param key\n * @param customStore Method to get a custom store. Use with caution (see the docs).\n */\nfunction get(key, customStore = defaultGetStore()) {\n    return customStore('readonly', (store) => promisifyRequest(store.get(key)));\n}\n/**\n * Set a value with a key.\n *\n * @param key\n * @param value\n * @param customStore Method to get a custom store. Use with caution (see the docs).\n */\nfunction set(key, value, customStore = defaultGetStore()) {\n    return customStore('readwrite', (store) => {\n        store.put(value, key);\n        return promisifyRequest(store.transaction);\n    });\n}\n/**\n * Set multiple values at once. This is faster than calling set() multiple times.\n * It's also atomic \u2013 if one of the pairs can't be added, none will be added.\n *\n * @param entries Array of entries, where each entry is an array of `[key, value]`.\n * @param customStore Method to get a custom store. Use with caution (see the docs).\n */\nfunction setMany(entries, customStore = defaultGetStore()) {\n    return customStore('readwrite', (store) => {\n        entries.forEach((entry) => store.put(entry[1], entry[0]));\n        return promisifyRequest(store.transaction);\n    });\n}\n/**\n * Get multiple values by their keys\n *\n * @param keys\n * @param customStore Method to get a custom store. Use with caution (see the docs).\n */\nfunction getMany(keys, customStore = defaultGetStore()) {\n    return customStore('readonly', (store) => Promise.all(keys.map((key) => promisifyRequest(store.get(key)))));\n}\n/**\n * Update a value. This lets you see the old value and update it as an atomic operation.\n *\n * @param key\n * @param updater A callback that takes the old value and returns a new value.\n * @param customStore Method to get a custom store. Use with caution (see the docs).\n */\nfunction update(key, updater, customStore = defaultGetStore()) {\n    return customStore('readwrite', (store) => \n    // Need to create the promise manually.\n    // If I try to chain promises, the transaction closes in browsers\n    // that use a promise polyfill (IE10/11).\n    new Promise((resolve, reject) => {\n        store.get(key).onsuccess = function () {\n            try {\n                store.put(updater(this.result), key);\n                resolve(promisifyRequest(store.transaction));\n            }\n            catch (err) {\n                reject(err);\n            }\n        };\n    }));\n}\n/**\n * Delete a particular key from the store.\n *\n * @param key\n * @param customStore Method to get a custom store. Use with caution (see the docs).\n */\nfunction del(key, customStore = defaultGetStore()) {\n    return customStore('readwrite', (store) => {\n        store.delete(key);\n        return promisifyRequest(store.transaction);\n    });\n}\n/**\n * Delete multiple keys at once.\n *\n * @param keys List of keys to delete.\n * @param customStore Method to get a custom store. Use with caution (see the docs).\n */\nfunction delMany(keys, customStore = defaultGetStore()) {\n    return customStore('readwrite', (store) => {\n        keys.forEach((key) => store.delete(key));\n        return promisifyRequest(store.transaction);\n    });\n}\n/**\n * Clear all values in the store.\n *\n * @param customStore Method to get a custom store. Use with caution (see the docs).\n */\nfunction clear(customStore = defaultGetStore()) {\n    return customStore('readwrite', (store) => {\n        store.clear();\n        return promisifyRequest(store.transaction);\n    });\n}\nfunction eachCursor(store, callback) {\n    store.openCursor().onsuccess = function () {\n        if (!this.result)\n            return;\n        callback(this.result);\n        this.result.continue();\n    };\n    return promisifyRequest(store.transaction);\n}\n/**\n * Get all keys in the store.\n *\n * @param customStore Method to get a custom store. Use with caution (see the docs).\n */\nfunction keys(customStore = defaultGetStore()) {\n    return customStore('readonly', (store) => {\n        // Fast path for modern browsers\n        if (store.getAllKeys) {\n            return promisifyRequest(store.getAllKeys());\n        }\n        const items = [];\n        return eachCursor(store, (cursor) => items.push(cursor.key)).then(() => items);\n    });\n}\n/**\n * Get all values in the store.\n *\n * @param customStore Method to get a custom store. Use with caution (see the docs).\n */\nfunction values(customStore = defaultGetStore()) {\n    return customStore('readonly', (store) => {\n        // Fast path for modern browsers\n        if (store.getAll) {\n            return promisifyRequest(store.getAll());\n        }\n        const items = [];\n        return eachCursor(store, (cursor) => items.push(cursor.value)).then(() => items);\n    });\n}\n/**\n * Get all entries in the store. Each entry is an array of `[key, value]`.\n *\n * @param customStore Method to get a custom store. Use with caution (see the docs).\n */\nfunction entries(customStore = defaultGetStore()) {\n    return customStore('readonly', (store) => {\n        // Fast path for modern browsers\n        // (although, hopefully we'll get a simpler path some day)\n        if (store.getAll && store.getAllKeys) {\n            return Promise.all([\n                promisifyRequest(store.getAllKeys()),\n                promisifyRequest(store.getAll()),\n            ]).then(([keys, values]) => keys.map((key, i) => [key, values[i]]));\n        }\n        const items = [];\n        return customStore('readonly', (store) => eachCursor(store, (cursor) => items.push([cursor.key, cursor.value])).then(() => items));\n    });\n}\n\nexport { clear, createStore, del, delMany, entries, get, getMany, keys, promisifyRequest, set, setMany, update, values };\n", "import { fileSave, fileOpen, directoryOpen } from \"browser-fs-access\";\nimport * as kv from \"idb-keyval\";\nimport { createElement, fsReadAllFiles } from \"./utils.js\";\n\n/** @type {FileSystemDirectoryHandle} */\nlet attachedDirHandle = null;\n\nexport function getAttachedDirHandle() {\n  return attachedDirHandle;\n}\n\nlet configuredMountPromiseResolve;\nconst configuredMountPromise = new Promise(resolve => {\n  configuredMountPromiseResolve = resolve;\n});\n\nexport async function configureMount() {\n  let type = new URLSearchParams(location.search).get('storage');\n  if (type !== 'fs' && type !== 'idb') type = undefined;\n\n  if (type === undefined) {\n    attachedDirHandle = await kv.get('attached-dir');\n    if (!self.showDirectoryPicker || attachedDirHandle === false || !await requestPermission()) {\n      type = 'idb';\n      attachedDirHandle = null;\n    } else {\n      type = 'fs';\n    }\n  }\n\n  // Mount the persisted files (saves folder and zc.cfg live here).\n  FS.mkdirTree('/local');\n  if (type === 'fs') {\n    await setAttachedDir(attachedDirHandle);\n  } else {\n    FS.mount(IDBFS, {}, '/local');\n  }\n  await ZC.fsSync(true);\n  if (!FS.analyzePath('/local/zc.cfg').exists) {\n    FS.writeFile('/local/zc.cfg', FS.readFile('/zc_web.cfg'));\n  }\n  if (!FS.analyzePath('/local/zquest.cfg').exists) {\n    FS.writeFile('/local/zquest.cfg', FS.readFile('/zquest_web.cfg'));\n  }\n  await renderSettingsPanel();\n  configuredMountPromiseResolve();\n}\n\nexport async function requestPermission() {\n  const options = { mode: 'readwrite' };\n\n  if (attachedDirHandle) {\n    if (await attachedDirHandle.queryPermission(options) === 'granted') return true;\n\n    try {\n      if (await attachedDirHandle.requestPermission(options) !== 'granted') {\n        return false;\n      }\n      return true;\n    } catch {\n      // ...\n    }\n  }\n\n  // User activation is required to request permissions\n  document.querySelector('.content').classList.add('hidden');\n  document.querySelector('.permission').classList.remove('hidden');\n  document.querySelector('.permission .folder-name').textContent = attachedDirHandle?.name;\n  document.querySelector('.permission .already-attached').classList.toggle('hidden', !attachedDirHandle);\n  document.querySelector('.permission .not-attached').classList.toggle('hidden', !!attachedDirHandle);\n\n  let result = await new Promise((resolve) => {\n    document.querySelector('.permission .ok').addEventListener('click', () => {\n      resolve(true);\n    });\n    document.querySelector('.permission .cancel').addEventListener('click', () => {\n      kv.set('attached-dir', false);\n      resolve(false);\n    });\n  });\n\n  if (result && !attachedDirHandle) {\n    try {\n      attachedDirHandle = await self.showDirectoryPicker({\n        id: 'zc',\n      });\n    } catch { }\n  }\n  if (result && attachedDirHandle) result = await attachedDirHandle.requestPermission(options) === 'granted';\n  document.querySelector('.content').classList.remove('hidden');\n  document.querySelector('.permission').classList.add('hidden');\n  return result;\n}\n\nasync function setAttachedDir(dirHandle) {\n  try {\n    FS.unmount('/local');\n  } catch { }\n\n  attachedDirHandle = dirHandle;\n  if (dirHandle) {\n    await kv.set('attached-dir', dirHandle);\n  } else {\n    await kv.del('attached-dir');\n  }\n\n  if (!dirHandle) return;\n\n  await import('./fsfs.js');\n  FS.mount(FSFS, { dirHandle: attachedDirHandle }, '/local');\n  await new Promise((resolve, reject) => FS.syncfs(true, (err) => {\n    if (err) return reject(err);\n    resolve();\n  }));\n}\n\nexport function setupSettingsPanel() {\n  const el = document.querySelector('.settings');\n\n  const filesEl = el.querySelector('.settings__browser-files');\n  filesEl.addEventListener('click', async (e) => {\n    const fileEl = e.target.closest('[data-path]');\n    if (!fileEl) return;\n\n    const path = fileEl.getAttribute('data-path');\n    const blob = new Blob([FS.readFile(path)]);\n    await fileSave(blob, {\n      fileName: path.replace('/local/', ''),\n    });\n  });\n\n  const criticalFileNames = ['zc.cfg', 'zquest.cfg', 'zc.sav'];\n\n  async function handleFilesCopy(files) {\n    // Just in case user is faster than the game.\n    await configuredMountPromise;\n\n    for (const file of files) {\n      let localRelPath;\n      if (file.webkitRelativePath) {\n        localRelPath = [\n          ...PATH.dirname(file.webkitRelativePath).split('/').slice(1),\n          PATH.basename(file.webkitRelativePath),\n        ].join('/');\n      } else {\n        localRelPath = file.name;\n      }\n\n      const path = '/local/' + localRelPath;\n\n      // Backup existing files.\n      if (FS.analyzePath(path).exists) {\n        const backupPath = '/local/.backup/' + localRelPath;\n        FS.mkdirTree(PATH.dirname(backupPath));\n        FS.writeFile(backupPath, FS.readFile(path));\n      }\n\n      FS.mkdirTree(PATH.dirname(path));\n      FS.writeFile(path, new Uint8Array(await file.arrayBuffer()));\n    }\n\n    await ZC.fsSync(false);\n    if (files.some(file => criticalFileNames.includes(file.name))) window.location.reload();\n    await renderSettingsPanel();\n  }\n\n  el.querySelector('.settings__copy button.copy-folder').addEventListener('click', async () => {\n    const files = await directoryOpen({ recursive: true });\n    await handleFilesCopy(files);\n  });\n  el.querySelector('.settings__copy button.copy-file').addEventListener('click', async () => {\n    const file = await fileOpen();\n    await handleFilesCopy([file]);\n  });\n\n  el.querySelector('.settings__attach button.attach').addEventListener('click', async () => {\n    const dir = await self.showDirectoryPicker({\n      id: 'zc',\n    });\n    await setAttachedDir(dir);\n    window.location.reload();\n  });\n  el.querySelector('.settings__attach button.unattach').addEventListener('click', async () => {\n    await setAttachedDir(null);\n    window.location.reload();\n  });\n}\n\nexport async function renderSettingsPanel() {\n  const el = document.querySelector('.settings');\n  const shouldUseDirPicker = !!self.showDirectoryPicker && attachedDirHandle;\n\n  {\n    el.querySelector('.settings__attach').classList.toggle('hidden', !shouldUseDirPicker);\n\n    const attachEl = el.querySelector('.settings__attach button.attach');\n    attachEl.classList.toggle('hidden', attachedDirHandle);\n\n    const unattachEl = el.querySelector('.settings__attach button.unattach');\n    unattachEl.classList.toggle('hidden', !attachedDirHandle);\n    unattachEl.textContent = `Folder attached: ${attachedDirHandle?.name}\u2013Click to unattach`;\n  }\n\n  el.querySelector('.settings__copy').classList.toggle('hidden', shouldUseDirPicker);\n\n  if (!shouldUseDirPicker) {\n    const filesEl = el.querySelector('.settings__browser-files');\n    filesEl.innerHTML = '';\n    for (const { path, timestamp } of fsReadAllFiles('/local')) {\n      const fileEl = createElement('div', 'file');\n      fileEl.append(createElement('div', '', path.replace('/local/', '')));\n      fileEl.append(createElement('div', '', new Date(timestamp).toLocaleString()));\n      fileEl.setAttribute('data-path', path);\n      filesEl.append(fileEl);\n    }\n  }\n\n  el.querySelector('.settings__download').classList.toggle('hidden', !!attachedDirHandle);\n\n  {\n    const cfgs = [\n      'zc.cfg',\n      'oot.cfg',\n      '2MGM.cfg',\n      'ultra.cfg',\n      'ppl160.cfg',\n      'freepats.cfg',\n    ];\n    let currentCfg = await kv.get('timidity-cfg');\n    if (!currentCfg || !FS.analyzePath(`/etc/${currentCfg}`).exists) {\n      currentCfg = cfgs[0];\n    }\n\n    const cfgsSelectEl = el.querySelector('.settings__timidity-cfgs select');\n    cfgsSelectEl.textContent = '';\n    for (const cfg of cfgs) {\n      const el = createElement('option', '', cfg);\n      cfgsSelectEl.append(el);\n    }\n    cfgsSelectEl.addEventListener('change', async () => {\n      await kv.set('timidity-cfg', cfgsSelectEl.value)\n    });\n    cfgsSelectEl.value = currentCfg;\n    FS.writeFile('/etc/timidity.cfg', FS.readFile(`/etc/${currentCfg}`));\n  }\n}\n", "import { configureMount, renderSettingsPanel, setupSettingsPanel } from \"./settings.js\";\nimport { createElement, createUrlString, fetchWithProgress, formatBytes } from \"./utils.js\";\nimport { handleFileLaunch } from \"./file_launch.js\";\n\nwindow.ZC = {\n  // TODO: this should be https://data.zquestclassic.com , but having issues with SSL/X-Amz-Meta-Inflated-Content-Size\n  dataOrigin: 'https://zc-data.nyc3.digitaloceanspaces.com',\n  pathToUrl: {},\n  setStatus: function (text, percentProgress = null) {\n    // `.data.js` emscripten generated script passes progress like this:\n    //   Downloading data... (x/y)\n    // And there's no way to configure that, so just parse it.\n    if (text.startsWith('Downloading data... (')) {\n      const [, x, y] = text.match(/(\\d+)\\/(\\d+)/);\n      text = `Downloading data... (${formatBytes(x, y, 'MB')})`;\n      percentProgress = x / y;\n    }\n\n    if (!text || text === 'Running...') return;\n    if (!ZC.setStatus.last) ZC.setStatus.last = { time: Date.now(), text: '' };\n\n    const statusElement = document.getElementById('status');\n    const progressElement = document.getElementById('progress');\n\n    if (text === 'Ready') {\n      progressElement.value = null;\n      progressElement.max = null;\n      progressElement.hidden = true;\n      statusElement.hidden = true;\n      return;\n    }\n\n    statusElement.hidden = false;\n\n    if (text === ZC.setStatus.last.text) return;\n    const now = Date.now();\n    if (percentProgress && now - ZC.setStatus.last.time < 30) return; // if this is a progress update, skip it if too soon\n    ZC.setStatus.last.time = now;\n    ZC.setStatus.last.text = text;\n    if (percentProgress !== null && percentProgress > 0) {\n      progressElement.value = percentProgress;\n      progressElement.max = 1;\n      progressElement.hidden = false;\n    } else {\n      progressElement.value = null;\n      progressElement.max = null;\n      progressElement.hidden = true;\n    }\n    statusElement.innerHTML = text;\n  },\n  async fetch(url, opts) {\n    const response = await fetchWithProgress(url, opts, (received, total, done) => {\n      if (done) {\n        ZC.setStatus('Ready');\n      } else if (received && total) {\n        ZC.setStatus(`Fetching file (${formatBytes(received, total)})`, received / total);\n      } else if (received) {\n        ZC.setStatus(`Fetching file (${formatBytes(received)})`);\n      } else {\n        ZC.setStatus('Fetching file');\n      }\n    });\n\n    const contentType = await response.headers.get('Content-Type');\n    if (contentType === 'application/json' || url.endsWith('.json')) {\n      const json = new TextDecoder('utf-8').decode(await response.arrayBuffer());\n      return JSON.parse(json);\n    }\n\n    return response;\n  },\n  async getQuestManifest() {\n    if (ZC.questManifestPromise) {\n      return ZC.questManifestPromise;\n    }\n\n    ZC.questManifestPromise = ZC.fetch(ZC.dataOrigin + '/manifest.json').catch(error => {\n      console.error(error.toString());\n      return [];\n    });\n    return ZC.questManifestPromise;\n  },\n  async fetchAsByteArray(url, opts) {\n    const response = await ZC.fetch(url, opts);\n    return new Uint8Array(await response.arrayBuffer());\n  },\n  url: '',\n  setShareableUrl(params) {\n    ZC.url = createUrlString('', params);\n  },\n  openTestMode(quest, dmap, screen, retsquare) {\n    if (0x80 < screen) return;\n\n    const params = { test: quest, dmap, screen };\n    if (retsquare !== -1) params.retsquare = retsquare;\n    const url = createUrlString(ZC_Constants.zeldaUrl, params);\n    window.open(url, '_blank');\n  },\n  async runZscriptCompiler(scriptPath, consolePath, qr) {\n    scriptPath = PATH.join('/root-fs', scriptPath);\n    consolePath = PATH.join('/root-fs', consolePath);\n\n    const {default: ZScript} = await import('./zscript.mjs' + (Math.random() ? '' : ''));\n    let onExitPromiseResolve;\n    const onExitPromise = new Promise(resolve => onExitPromiseResolve = resolve);\n    await ZScript({\n      preRun(zscript) {\n        // For some reason `set_config_file` errors if the file doesn't exist ...\n        if (!FS.analyzePath('/local/zscript.cfg').exists) FS.writeFile('/local/zscript.cfg', '');\n\n        zscript.FS.mkdir('/root-fs');\n        zscript.FS.mount(PROXYFS, {\n          root: '/',\n          fs: FS,\n        }, '/root-fs');\n        zscript.FS.chdir('/root-fs');\n      },\n      onExit: onExitPromiseResolve,\n      arguments: ['-linked', '-input', scriptPath, '-console', consolePath, '-qr', qr],\n    });\n\n    const code = await onExitPromise;\n    // Not necessary, but avoids lag when playing the sfx.\n    await new Promise(resolve => setTimeout(resolve, 100));\n    return {code};\n  },\n  async fsSync(populate) {\n    // Sync /local to IndexedDB or to the attached folder.\n    await new Promise((resolve, reject) => FS.syncfs(populate, (err) => {\n      if (err) return reject(err);\n      resolve();\n    }));\n  },\n  configureMount,\n};\n\nasync function main() {\n  window.Module = window.Module || {};\n  Module.noInitialRun = true;\n\n  let readyToRunPromiseResolve;\n  const readyToRunPromise = new Promise(resolve => readyToRunPromiseResolve = resolve);\n\n  // window.Module = await initModule({\n  window.Module = Object.assign(Module, {\n    arguments: [],\n    canvas: document.querySelector('canvas'),\n    instantiateWasm,\n    onRuntimeInitialized: () => {\n      if (TARGET === 'zplayer') setupTouchControls();\n      else {\n        // TODO: better way to hide touch controls (just don't render them?)\n        for (const el of [...document.querySelectorAll('.touch-inputs')]) {\n          el.classList.toggle('hidden', true);\n        }\n      }\n      setupCopyUrl();\n      setupSettingsPanel();\n      if (TARGET === 'zeditor') setupOpenTestMode();\n      readyToRunPromiseResolve();\n    },\n    setStatus: function (text, percentProgress = null) {\n      ZC.setStatus(text, percentProgress);\n    },\n    expectedDataFileDownloads: 0,\n    totalDependencies: 0,\n    monitorRunDependencies: function (left) {\n      Module.totalDependencies = Math.max(Module.totalDependencies, left);\n      if (Module.totalDependencies === 1) return;\n\n      const progress = (Module.totalDependencies - left) / (Module.totalDependencies);\n      ZC.setStatus(left ? `Preparing... (${Module.totalDependencies - left}/${Module.totalDependencies})` : '', progress);\n    },\n    onExit: function (code) {\n      const msg = `exit with code: ${code}`;\n      if (code === 0) {\n        console.log(msg);\n      } else {\n        console.error(msg);\n      }\n    },\n    preRun: [() => {\n      if (IS_CI) ENV.CI = '1';\n    }],\n    locateFile: function (file, base) {\n      return new URL(file, base || rootUrl).href;\n    },\n  });\n\n  const params = new URLSearchParams(location.search);\n  const args = Module.arguments;\n\n  let openPath = params.get('open');\n  if (openPath) {\n    const manifest = await ZC.getQuestManifest();\n    openPath = openPath.startsWith('/') ? openPath : `/${openPath}`;\n    const m = (openPath.startsWith('/quests/') || openPath.startsWith('/tilesets/')) && openPath.match(/\\/([^/]*\\/[^/]*\\/[^/]*)\\/?(.*)?/);\n    if (m) {\n      const [, id, file] = m;\n      if (!file && manifest[id]) {\n        openPath = `/${manifest[id].defaultPath}`;\n      }\n    }\n  }\n\n  if (openPath) {\n    if (TARGET === 'zeditor') args.push(openPath);\n    else if (TARGET === 'zplayer') args.push('-web-open', openPath);\n  }\n\n  if (TARGET === 'zplayer') {\n    const testPath = params.get('test');\n    const screen = params.get('screen');\n    const dmap = params.get('dmap');\n    const retsquare = params.get('retsquare');\n    if (testPath && screen && dmap) {\n      args.push('-test', testPath, dmap, screen);\n      if (retsquare) args.push(retsquare);\n      document.querySelector('.button--testmode').classList.remove('hidden');\n    }\n  }\n\n  for (const [key, value] of params.entries()) {\n    if (['test', 'screen', 'dmap', 'retsquare', 'open'].includes(key)) {\n      continue;\n    }\n\n    const cliSwitch = '-' + key.replace(/[A-Z]/g, (match, offset) => (offset > 0 ? '-' : '') + match.toLowerCase());\n    args.push(cliSwitch);\n    if (value !== '') args.push(value);\n  }\n\n  window.addEventListener('resize', resize);\n  resize();\n\n  const requestPersist = () => {\n    navigator.storage.persist();\n    canvas.removeEventListener('click', requestPersist);\n  }\n  canvas.addEventListener('click', requestPersist);\n\n  for (const el of [...document.querySelectorAll('.panel-button[data-panel]')]) {\n    el.addEventListener('click', async () => {\n      for (const buttonEl of document.querySelectorAll('.panel-button')) {\n        const panelEl = document.querySelector(buttonEl.getAttribute('data-panel'));\n        if (el === buttonEl) {\n          buttonEl.classList.toggle('active');\n          if (panelEl) panelEl.classList.toggle('hidden');\n          if (panelEl && buttonEl.getAttribute('data-panel') === '.settings') await renderSettingsPanel();\n        } else {\n          buttonEl.classList.remove('active');\n          if (panelEl) panelEl.classList.add('hidden');\n        }\n      }\n\n      const canvasFocus = !document.querySelector('.panel-button.active');\n      document.body.classList.toggle('canvas-focus', canvasFocus);\n      document.querySelector('.content').classList.toggle('hidden', !canvasFocus);\n      if (canvasFocus) {\n        resize();\n        document.body.scrollIntoView();\n      }\n    });\n  }\n  document.body.classList.toggle('canvas-focus', true);\n\n  await readyToRunPromise;\n  callMain(Module.arguments);\n\n  await renderQuestList();\n\n  if (params.has('launch')) {\n    const result = await handleFileLaunch();\n    if (result.openInEditor) {\n      window.location.href = createUrlString(ZC_Constants.zquestUrl, { open: result.quest });\n    } else {\n      window.location.href = createUrlString(ZC_Constants.zeldaUrl, { open: result.quest });\n    }\n  }\n}\n\n// This is exactly the code from Emscripten's `instantiateWasm` except it uses\n// ZC.fetch to provide progress updates when downloading the wasm file.\n// TODO: no it doesn't, because of a chrome bug where caching won't work with a wrapper Response object,\n// which is used for progress tracking. So for now, this just won't give a progress indicator.\n// https://bugs.chromium.org/p/chromium/issues/detail?id=719172#c102\nfunction instantiateWasm(info, receiveInstance) {\n  function instantiateArrayBuffer(receiver) {\n    return getBinaryPromise().then(function (binary) {\n      return WebAssembly.instantiate(binary, info);\n    }).then(function (instance) {\n      return instance;\n    }).then(receiver, function (reason) {\n      err(\"failed to asynchronously prepare wasm: \" + reason);\n      if (isFileURI(wasmBinaryFile)) {\n        err(\"warning: Loading from a file URI (\" + wasmBinaryFile + \") is not supported in most browsers. See https://emscripten.org/docs/getting_started/FAQ.html#how-do-i-run-a-local-webserver-for-testing-why-does-my-program-stall-in-downloading-or-preparing\");\n      }\n      abort(reason);\n    });\n  }\n\n  function receiveInstantiationResult(result) {\n    receiveInstance(result[\"instance\"], result[\"module\"]);\n  }\n\n  if (!wasmBinary && typeof WebAssembly.instantiateStreaming == \"function\" && !isDataURI(wasmBinaryFile) && !isFileURI(wasmBinaryFile) && typeof fetch == \"function\") {\n    // TODO should be ZC.fetch, but see above TODO comment.\n    return fetch(wasmBinaryFile, {\n      credentials: \"same-origin\"\n    }).then(function (response) {\n      var result = WebAssembly.instantiateStreaming(response, info);\n      return result.then(receiveInstantiationResult, function (reason) {\n        err(\"wasm streaming compile failed: \" + reason);\n        err(\"falling back to ArrayBuffer instantiation\");\n        return instantiateArrayBuffer(receiveInstantiationResult);\n      });\n    });\n  } else {\n    return instantiateArrayBuffer(receiveInstantiationResult);\n  }\n}\n\nfunction resize() {\n  let w = 640;\n  let h = 480;\n  const heightAvail = innerHeight - document.querySelector('header').clientHeight;\n  const canvasScale = Math.min(innerWidth / w, heightAvail / h);\n  canvas.style.width = (Math.floor(w * canvasScale)) + \"px\";\n  canvas.style.height = (Math.floor(h * canvasScale)) + \"px\";\n}\n\nasync function renderQuestList() {\n  const questListEl = document.querySelector('.quest-list');\n  const questListEntriesEl = questListEl.querySelector('.quest-list__entries-list');\n  const questListCurrentEl = questListEl.querySelector('.quest-list__current');\n  const questListCurrentTemplate = document.querySelector('.tmpl-selected-quest');\n\n  const manifest = await ZC.getQuestManifest();\n  const quests = Object.values(manifest);\n\n  for (const quest of quests) {\n    if (quest.type !== 'quests') continue;\n    if (!['auto', true].includes(quest.approval)) continue;\n\n    const el = document.createElement('div');\n    el.classList.add('quest-list__entry');\n    el.setAttribute('data-quest-index', quests.indexOf(quest));\n    el.quest = quest;\n    el.append(quest.name);\n    questListEntriesEl.append(el);\n    el.tabIndex = -1;\n  }\n\n  questListEntriesEl.addEventListener('keyup', (e) => {\n    if (e.keyCode === 38) {\n      const questIndex = Number(e.target.previousElementSibling.getAttribute('data-quest-index'));\n      const quest = quests[questIndex];\n      showQuest(quest);\n      e.target.previousElementSibling.focus();\n    } else if (e.keyCode === 40 && e.target.nextElementSibling) {\n      const questIndex = Number(e.target.nextElementSibling.getAttribute('data-quest-index'));\n      const quest = quests[questIndex];\n      showQuest(quest);\n      e.target.nextElementSibling.focus();\n    }\n  });\n\n  function showQuest(quest) {\n    const questPrefix = `${ZC.dataOrigin}/${quest.id}`;\n\n    document.querySelector('.quest-list__entry.selected')?.classList.remove('selected');\n    document.querySelector(`.quest-list__entry[data-quest-index=\"${quests.indexOf(quest)}\"]`).classList.add('selected');\n\n    const contentEl = questListCurrentTemplate.content.cloneNode(true).children[0];\n\n    function fillOrDelete(selector, value) {\n      if (value) {\n        contentEl.querySelector(selector).textContent = value;\n      } else {\n        contentEl.querySelector(selector).parentElement.remove();\n      }\n    }\n\n    fillOrDelete('.name', quest.name);\n    fillOrDelete('.author', quest.authors.map(a => a.name).join(', '));\n    fillOrDelete('.genre', quest.genre);\n    fillOrDelete('.version', quest.version);\n\n    if (quest.projectUrl) {\n      contentEl.querySelector('.purezc-link').href = quest.projectUrl;\n    } else {\n      contentEl.querySelector('.purezc-link').remove();\n    }\n\n    if (quest.rating) {\n      contentEl.querySelector('.rating').textContent = quest.rating.score;\n      contentEl.querySelector('.rating-votes').textContent = quest.rating.distribution.reduce((a, b) => a + b, 0);\n    } else {\n      contentEl.querySelector('._rating').remove();\n    }\n\n    if (quest.informationHtml) contentEl.querySelector('.information').innerHTML = quest.informationHtml;\n    if (quest.descriptionHtml) contentEl.querySelector('.description').innerHTML = quest.descriptionHtml;\n    if (quest.storyHtml) contentEl.querySelector('.story').innerHTML = quest.storyHtml;\n    if (quest.tipsAndCheatsHtml) contentEl.querySelector('.tips').innerHTML = quest.tipsAndCheatsHtml;\n    if (quest.creditsHtml) contentEl.querySelector('.credits').innerHTML = quest.creditsHtml;\n\n    function setCurImage(image) {\n      const imgEl = document.createElement('img');\n      imgEl.crossOrigin = 'anonymous';\n      imgEl.src = `${questPrefix}/${image}`;\n      contentEl.querySelector('.current-image').innerHTML = '';\n      contentEl.querySelector('.current-image').append(imgEl);\n    }\n\n    const imagesEl = contentEl.querySelector('.images');\n    if (quest.images.length > 1) {\n      for (const image of quest.images) {\n        const imgEl = document.createElement('img');\n        imgEl.crossOrigin = 'anonymous';\n        imgEl.src = `${questPrefix}/${image}`;\n        imagesEl.append(imgEl);\n        imgEl.addEventListener('click', () => {\n          setCurImage(image);\n        });\n        imgEl.addEventListener('mouseover', () => {\n          setCurImage(image);\n        });\n      }\n    }\n\n    if (quest.images.length > 0) setCurImage(quest.images[0]);\n\n    const release = quest.releases[0];\n    const qsts = release.resources.filter(r => r.endsWith('.qst'));\n    for (const resource of qsts) {\n      // Only set `name` query param, which doesn't do anything, when making a link for\n      // a quest that only has a single qst file. Otherwise, to disambiguate use the entire\n      // file path (which likely makes obvious the name of the quest).\n      const openParamValue = qsts.length > 1 ?\n        `${quest.id}/${release.name}/${resource}` :\n        quest.id;\n      const args = {open: openParamValue};\n      if (qsts.length === 1) {\n        args.name = quest.name.replace(/['!?]/g, '').replace(/[\\s:&]+/g, '-').replace(/[-]+/g, '-');\n      }\n\n      const playEl = createElement('a', 'play-link');\n      playEl.href = createUrlString(ZC_Constants.zeldaUrl, args);\n      playEl.textContent = 'Play!';\n\n      const editEl = createElement('a');\n      editEl.href = createUrlString(ZC_Constants.zquestUrl, args);\n      editEl.textContent = 'Open in Editor';\n\n      const el = createElement('div', 'link-group');\n      contentEl.querySelector('.links').append(el);\n      el.append(resource, playEl, editEl);\n    }\n\n    questListCurrentEl.textContent = '';\n    questListCurrentEl.append(contentEl);\n  }\n\n  questListEntriesEl.addEventListener('click', (e) => {\n    const entryEl = e.target.closest('.quest-list__entry');\n    if (!entryEl) return;\n\n    const questIndex = Number(entryEl.getAttribute('data-quest-index'));\n    const quest = quests[questIndex];\n    showQuest(quest);\n  });\n\n  for (const el of document.querySelectorAll('.quest-list__sort-option')) {\n    el.addEventListener('click', () => {\n      const field = el.textContent;\n\n      let sortBy;\n      if (field === 'Name') {\n        sortBy = (a, b) => {\n          return a.textContent.localeCompare(b.textContent);\n        };\n      } else if (field === 'Rating') {\n        sortBy = (a, b) => {\n          const score_a = a.quest.rating?.score || 0;\n          const score_b = b.quest.rating?.score || 0;\n          return score_b - score_a;\n        };\n      }\n\n      [...questListEntriesEl.children]\n        .sort(sortBy)\n        .forEach(node => questListEntriesEl.appendChild(node));\n    });\n  }\n\n  const qsQuest = new URLSearchParams(location.search).get('quest');\n  const qsQuestId = qsQuest ? qsQuest.match(/(quests\\/purezc\\/\\d+)/)?.[0] : '';\n  const initialSelectedQuest = (qsQuestId && quests.find(q => q.id == qsQuestId)) || quests.find(q => ['auto', true].includes(q.approval));\n  if (initialSelectedQuest) showQuest(initialSelectedQuest);\n}\n\nfunction setupTouchControls() {\n  const createKeyEvent = Module.cwrap('create_synthetic_key_event', null, ['int', 'int']);\n  const EVENTS = {\n    KEY_DOWN: 10,\n    KEY_CHAR: 11,\n    KEY_UP: 12,\n  };\n  const KEY_CODES = {\n    B: 26,\n    A: 24,\n    Start: 67,\n    Map: 75,\n    L: 1,\n    R: 19,\n    Left: 82,\n    Right: 83,\n    Down: 84,\n    Up: 85,\n  };\n  const getDirectionalKey = (x, y) => {\n    if (x === -1) return KEY_CODES.Left;\n    if (x === 1) return KEY_CODES.Right;\n    if (y === -1) return KEY_CODES.Down;\n    if (y === 1) return KEY_CODES.Up;\n  }\n  const sendKeyEvent = (eventType, key) => {\n    if (eventType === 'touchstart') createKeyEvent(EVENTS.KEY_DOWN, key);\n    if (eventType === 'touchmove' || eventType === 'touchstart') createKeyEvent(EVENTS.KEY_CHAR, key);\n    if (eventType === 'touchend') createKeyEvent(EVENTS.KEY_UP, key);\n  };\n\n  const getKeysForInputElement = (el) => {\n    const action = el.getAttribute('data-action');\n    if (action) {\n      return [KEY_CODES[action]];\n    }\n\n    const keys = [];\n    const x = Number(el.getAttribute('data-x'));\n    const y = Number(el.getAttribute('data-y'));\n    if (x) keys.push(getDirectionalKey(x, 0));\n    if (y) keys.push(getDirectionalKey(0, y));\n\n    return keys;\n  }\n\n  for (const touchInputsEl of document.querySelectorAll('.touch-inputs')) {\n    let activeInputEl = null;\n    const setActiveInputEl = el => {\n      if (activeInputEl) activeInputEl.classList.remove('pressed');\n      activeInputEl = el;\n      if (activeInputEl) activeInputEl.classList.add('pressed');\n    };\n\n    const touchFn = (eventType, e) => {\n      let touch;\n      if (eventType === 'touchend') {\n        if (e.targetTouches.length !== 0) return;\n        touch = e.changedTouches[0];\n      } else {\n        if (e.targetTouches.length !== 1) return;\n        touch = e.targetTouches[0];\n      }\n\n      const elementMouseIsOver = document.elementFromPoint(touch.clientX, touch.clientY);\n      const inputEl = elementMouseIsOver.classList.contains('touch-input') ? elementMouseIsOver : null;\n\n      if (!inputEl && elementMouseIsOver.closest('.touch-inputs') === touchInputsEl && eventType !== 'touchend') {\n        // In the \"dead zone\" between the inputs (ex: the middle of the dpad).\n        return;\n      }\n\n      if (activeInputEl && (inputEl !== activeInputEl || !inputEl)) {\n        for (const key of getKeysForInputElement(activeInputEl)) {\n          sendKeyEvent('touchend', key);\n        }\n      }\n\n      if (!inputEl) {\n        setActiveInputEl(null);\n        return;\n      }\n\n      for (const key of getKeysForInputElement(inputEl)) {\n        sendKeyEvent(eventType, key);\n      }\n\n      setActiveInputEl(eventType === 'touchend' ? null : inputEl);\n    };\n\n    touchInputsEl.addEventListener('touchstart', e => touchFn('touchstart', e));\n    touchInputsEl.addEventListener('touchmove', e => touchFn('touchmove', e));\n    touchInputsEl.addEventListener('touchend', e => touchFn('touchend', e));\n    touchInputsEl.addEventListener('touchcancel', e => touchFn('touchend', e));\n    touchInputsEl.addEventListener('contextmenu', e => e.preventDefault());\n  }\n}\n\nfunction setupCopyUrl() {\n  const el = document.querySelector('.button--copyurl');\n  el.classList.remove('hidden');\n\n  // TODO: this should just return the string.\n  const getShareableUrl = Module.cwrap('get_shareable_url', 'undefined', []);\n  el.addEventListener('click', () => {\n    getShareableUrl();\n    if (ZC.url) navigator.clipboard.writeText(ZC.url);\n  });\n}\n\nfunction setupOpenTestMode() {\n  const el = document.querySelector('.button--open-testmode');\n  el.classList.remove('hidden');\n\n  const openTestMode = Module.cwrap('open_test_mode', null, []);\n  el.addEventListener('click', () => {\n    openTestMode();\n  });\n}\n\nfunction checkForGamepads() {\n  const hasGamepad = navigator.getGamepads().some(Boolean);\n  for (const el of [...document.querySelectorAll('.touch-inputs')]) {\n    el.classList.toggle('hidden', hasGamepad);\n  }\n}\n\nfunction goFullscreen() {\n  document.querySelector('main').requestFullscreen();\n}\n\nmain().catch(err => {\n  console.error(err);\n  document.querySelector('.content').textContent = err.toString();\n});\ncheckForGamepads();\nwindow.addEventListener('gamepadconnected', checkForGamepads);\nwindow.addEventListener('gamepaddisconnected', checkForGamepads);\n\nconst fullscreenEl = document.createElement('button');\nfullscreenEl.textContent = 'Fullscreen';\nfullscreenEl.classList.add('panel-button');\nfullscreenEl.addEventListener('click', goFullscreen);\ndocument.addEventListener('DOMContentLoaded', () => {\n  document.querySelector('.panel-buttons').append(fullscreenEl);\n});\n\n// If using gamepad, probably want to go fullscreen.\n// TODO https://bugs.chromium.org/p/chromium/issues/detail?id=1413066\n// if (TARGET === 'zplayer') {\n//   window.addEventListener('gamepadconnected', goFullscreen, { once: true });\n// }\n", "import { configureMount, getAttachedDirHandle } from \"./settings.js\";\n\nfunction fail(message) {\n  alert(message);\n  window.location.reload();\n}\n\nexport async function handleFileLaunch() {\n  if (!(window.launchQueue && 'files' in LaunchParams.prototype)) {\n    document.body.textContent = 'This page is only for opening files from an installed PWA';\n    return;\n  }\n\n  await configureMount();\n  const dirHandle = getAttachedDirHandle();\n  if (!dirHandle) {\n    fail('Sorry, you can only open files this way if you\\'ve attached a folder. See Settings');\n    return;\n  }\n\n  document.querySelector('.content').classList.add('hidden');\n  document.querySelector('.file-handler').classList.remove('hidden');\n\n  const launchedFile = await new Promise((resolve, reject) => {\n    launchQueue.setConsumer(async (launchParams) => {\n      console.log('...', launchParams.files);\n      if (!launchParams.files.length) {\n        reject(new Error('No files found'));\n        return;\n      }\n\n      resolve(launchParams.files[0]);\n    });\n  });\n\n  const relativePaths = await dirHandle.resolve(launchedFile);\n  if (!relativePaths) {\n    fail('Sorry, but that file is not inside the attached folder and cannot be opened directly');\n    return;\n  }\n\n  const relativePath = relativePaths.join('/');\n  const quest = `local/${relativePath}`;\n\n  const openInEditor = await new Promise(resolve => {\n    document.querySelectorAll('.file-handler button')[0].addEventListener('click', () => {\n      resolve(false);\n    });\n    document.querySelectorAll('.file-handler button')[1].addEventListener('click', () => {\n      resolve(true);\n    });\n  });\n\n  document.querySelector('.content').classList.remove('hidden');\n  document.querySelector('.file-handler').classList.add('hidden');\n\n  return {openInEditor, quest};\n}\n"],
  "mappings": "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",
  "names": ["fetchWithProgress", "url", "opts", "progressCb", "response", "contentLength", "inflatedContentLength", "transferSize", "compressionRatio", "responseBytesRecieved", "controller", "reader", "done", "value", "createUrlString", "pathname", "params", "key", "fsReadAllFiles", "folder", "files", "impl", "curFolder", "name", "path", "mode", "timestamp", "createElement", "tagName", "className", "textContent", "el", "formatBytes", "bytes1", "bytes2", "unit", "b", "scale", "fixedUnits", "getFsHandles", "init_utils", "__esmMin", "dirHandle", "handles", "collect", "curDirHandle", "entry", "result", "handle", "relativePath", "fsfs_exports", "mergeInto", "obj", "other", "LibraryManager", "init_fsfs", "__esmMin", "init_utils", "mount", "populate", "callback", "local", "remote", "src", "dst", "e", "entries", "isRealDir", "p", "toAbsolute", "root", "check", "path", "stat", "handles", "getFsHandles", "handle", "node", "entry", "file", "parentDirHandle", "writable", "total", "create", "key", "e2", "remove", "relPath", "e", "t", "l", "v", "n", "r", "y", "b", "i", "a", "m", "k", "o", "s", "c", "u", "p", "d", "f", "w", "h", "P", "promisifyRequest", "request", "resolve", "reject", "createStore", "dbName", "storeName", "dbp", "txMode", "callback", "db", "defaultGetStoreFunc", "defaultGetStore", "get", "key", "customStore", "store", "set", "value", "del", "key", "customStore", "defaultGetStore", "store", "promisifyRequest", "init_utils", "attachedDirHandle", "getAttachedDirHandle", "configuredMountPromiseResolve", "configuredMountPromise", "resolve", "configureMount", "type", "get", "requestPermission", "setAttachedDir", "renderSettingsPanel", "options", "result", "set", "dirHandle", "del", "reject", "err", "setupSettingsPanel", "el", "e", "fileEl", "path", "blob", "o", "criticalFileNames", "handleFilesCopy", "files", "file", "localRelPath", "backupPath", "i", "n", "dir", "shouldUseDirPicker", "unattachEl", "filesEl", "timestamp", "fsReadAllFiles", "createElement", "cfgs", "currentCfg", "cfgsSelectEl", "cfg", "init_utils", "fail", "message", "handleFileLaunch", "configureMount", "dirHandle", "getAttachedDirHandle", "launchedFile", "resolve", "reject", "launchParams", "relativePaths", "quest", "openInEditor", "text", "percentProgress", "x", "y", "formatBytes", "statusElement", "progressElement", "now", "url", "opts", "response", "fetchWithProgress", "received", "total", "done", "json", "error", "params", "createUrlString", "quest", "dmap", "screen", "retsquare", "scriptPath", "consolePath", "qr", "ZScript", "globImport_zscript_mjs", "onExitPromiseResolve", "onExitPromise", "resolve", "zscript", "code", "populate", "reject", "err", "configureMount", "main", "readyToRunPromiseResolve", "readyToRunPromise", "instantiateWasm", "setupTouchControls", "el", "setupCopyUrl", "setupSettingsPanel", "setupOpenTestMode", "left", "progress", "msg", "file", "base", "args", "openPath", "manifest", "m", "id", "testPath", "key", "value", "cliSwitch", "match", "offset", "resize", "requestPersist", "buttonEl", "panelEl", "renderSettingsPanel", "canvasFocus", "renderQuestList", "result", "handleFileLaunch", "info", "receiveInstance", "instantiateArrayBuffer", "receiver", "binary", "instance", "reason", "receiveInstantiationResult", "w", "h", "heightAvail", "canvasScale", "questListEl", "questListEntriesEl", "questListCurrentEl", "questListCurrentTemplate", "quests", "e", "questIndex", "showQuest", "questPrefix", "contentEl", "fillOrDelete", "selector", "a", "b", "setCurImage", "image", "imgEl", "imagesEl", "release", "qsts", "r", "resource", "playEl", "createElement", "editEl", "entryEl", "field", "sortBy", "score_a", "node", "qsQuest", "qsQuestId", "initialSelectedQuest", "q", "createKeyEvent", "EVENTS", "KEY_CODES", "getDirectionalKey", "sendKeyEvent", "eventType", "getKeysForInputElement", "action", "keys", "touchInputsEl", "activeInputEl", "setActiveInputEl", "touchFn", "touch", "elementMouseIsOver", "inputEl", "getShareableUrl", "openTestMode", "checkForGamepads", "hasGamepad", "goFullscreen", "fullscreenEl"]
}
